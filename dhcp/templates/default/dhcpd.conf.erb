# dhcpd.conf file

<% # dhcpd configuration files are composed of a sequence of nested blocks %>
<% queue = @blocks.reverse %>
<% while not queue.empty? do %>
<%   depth = 0 %>
<%   finger = queue %>
<%   block = finger.last %>
<%   while block.is_a?(Array) do %>
<%     if block.empty? %>
<%=      ["\t"*depth, "}"].join("") %>
<%       block = nil %>
<%     else %>
<%       depth += 1 %>
<%       finger = block %>
<%       block = finger.last %>
<%     end %>
<%   end %>
<%   finger.pop %>
<%   if block.nil? %>
<%     next %>
<%   end %>
<%   output = ["\t"*depth, block[:keyword]] %>
<%   block[:values].length().times do |i| %>
<%     output << " " %>
<%     value = block[:values][i] %>
<%     case value %>
<%     when /^[\d-]/ %>
<%       output << value %>
<%     else %>
<%       if block[:keyword] != :option or i > 0 %>
<%         output << "\"#{value}\"" %>
<%       else %>
<%         output << value %>
<%       end %>
<%     end %>
<%   end %>
<%   if block.has_key?(:blocks) %>
<%     output << " {" %>
<%     finger.push(block[:blocks]) %>
<%   else %>
<%     output << ";" %>
<%   end %>
<%=  output.join("") %>
<% end %>
